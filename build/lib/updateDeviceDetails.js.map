{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceDetails.ts"],
  "sourcesContent": ["import axios from 'axios';\nimport type { Modes } from '../types';\nimport { getProtocolCodes } from './axiosParameter';\nimport { getSUrlUpdateDeviceId } from './endPoints';\nimport { saveValue } from './saveValue';\nimport { initStore } from './store';\nimport { errorLogger } from './logging';\nimport type { MidasAquatemp } from '../main';\n\nexport const numberToBoolean = (value: number): boolean => {\n    return value === 1;\n};\n\nconst saveValues = async (adapter: MidasAquatemp, value: any): Promise<void> => {\n    // Stromverbrauch T07 x T14 in Watt\n    await saveValue(\n        'consumption',\n        parseFloat(findCodeVal(value, ['T07', 'T7'])) * parseFloat(findCodeVal(value, 'T14')),\n        'number',\n        adapter,\n    );\n    // Luftansaug-Temperatur T01\n    await saveValue('suctionTemp', parseFloat(findCodeVal(value, ['T01', 'T1'])), 'number', adapter);\n    // Inlet-Temperatur T02\n    await saveValue('tempIn', parseFloat(findCodeVal(value, ['T02', 'T2'])), 'number', adapter);\n    // outlet-Temperatur T03\n    await saveValue('tempOut', parseFloat(findCodeVal(value, ['T03', 'T3'])), 'number', adapter);\n    // Coil-Temperatur T04\n    await saveValue('coilTemp', parseFloat(findCodeVal(value, ['T04', 'T4'])), 'number', adapter);\n    // Umgebungs-Temperatur T05\n    await saveValue('ambient', parseFloat(findCodeVal(value, ['T05', 'T5'])), 'number', adapter);\n    // Kompressorausgang-Temperatur T06\n    await saveValue('exhaust', parseFloat(findCodeVal(value, ['T06', 'T6'])), 'number', adapter);\n    // Str\u00F6mungsschalter S03\n    await saveValue('flowSwitch', numberToBoolean(findCodeVal(value, ['S03', 'S3'])), 'boolean', adapter);\n    // L\u00FCfter-Drehzahl T17\n    await saveValue('rotor', parseInt(findCodeVal(value, 'T17')), 'number', adapter);\n};\n\nexport async function updateDeviceDetails(adapter: MidasAquatemp): Promise<void> {\n    const store = initStore();\n    try {\n        const { apiLevel, token, device: deviceCode } = store;\n        if (token) {\n            const { sURL } = getSUrlUpdateDeviceId();\n\n            const response = await axios.post(sURL, getProtocolCodes(deviceCode), {\n                headers: { 'x-token': token },\n            });\n            store._this.log.debug(`DeviceDetails: ${JSON.stringify(response.data)}`);\n\n            if (parseInt(response.data.error_code) == 0) {\n                const responseValue = apiLevel < 3 ? response.data.object_result : response.data.objectResult;\n\n                await saveValue('rawJSON', JSON.stringify(responseValue), 'string', adapter);\n                await saveValues(adapter, responseValue);\n\n                const mode: number = findCodeVal(responseValue, 'Mode');\n                const modes: Modes = {\n                    1: 'R02', // Heiz-Modus (-> R02)\n                    0: 'R01', // K\u00FChl-Modus (-> R01)\n                    2: 'R03', // Auto-Modus (-> R03)\n                };\n                // Ziel-Temperatur anhand Modus\n                await saveValue('tempSet', parseFloat(findCodeVal(responseValue, modes[mode])), 'number', adapter);\n\n                // Fl\u00FCstermodus Manual-mute\n                await saveValue('silent', findCodeVal(responseValue, 'Manual-mute') == '1', 'boolean', adapter);\n\n                // Zustand Power\n                if (findCodeVal(responseValue, 'Power') == '1') {\n                    await saveValue('state', true, 'boolean', adapter);\n                    await saveValue('mode', findCodeVal(responseValue, 'Mode'), 'string', adapter);\n                } else {\n                    await saveValue('state', false, 'boolean', adapter);\n                    await saveValue('mode', '-1', 'string', adapter);\n                }\n\n                await saveValue('info.connection', true, 'boolean', adapter);\n                return;\n            }\n\n            adapter.log.error(`Error: ${JSON.stringify(response.data)}`);\n            store.resetOnErrorHandler();\n            return;\n        }\n        return;\n    } catch (error: any) {\n        errorLogger('Error updateDeviceDetails', error, adapter);\n    }\n}\n\nfunction findCodeVal(result: { value: string; code: string }[], code: string | string[]): any {\n    if (!Array.isArray(code)) {\n        return result.find(item => item.code === code)?.value || '';\n    }\n    for (let i = 0; i < code.length; i++) {\n        const val = result.find(item => item.code === code[i])?.value;\n        if (val !== '0') {\n            return val;\n        }\n    }\n    return '0';\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAElB,4BAAiC;AACjC,uBAAsC;AACtC,uBAA0B;AAC1B,mBAA0B;AAC1B,qBAA4B;AAGrB,MAAM,kBAAkB,CAAC,UAA2B;AACvD,SAAO,UAAU;AACrB;AAEA,MAAM,aAAa,OAAO,SAAwB,UAA8B;AAE5E,YAAM;AAAA,IACF;AAAA,IACA,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,IAAI,WAAW,YAAY,OAAO,KAAK,CAAC;AAAA,IACpF;AAAA,IACA;AAAA,EACJ;AAEA,YAAM,4BAAU,eAAe,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE/F,YAAM,4BAAU,UAAU,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE1F,YAAM,4BAAU,WAAW,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE3F,YAAM,4BAAU,YAAY,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE5F,YAAM,4BAAU,WAAW,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE3F,YAAM,4BAAU,WAAW,WAAW,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAE3F,YAAM,4BAAU,cAAc,gBAAgB,YAAY,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC,GAAG,WAAW,OAAO;AAEpG,YAAM,4BAAU,SAAS,SAAS,YAAY,OAAO,KAAK,CAAC,GAAG,UAAU,OAAO;AACnF;AAEA,eAAsB,oBAAoB,SAAuC;AAC7E,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,UAAM,EAAE,UAAU,OAAO,QAAQ,WAAW,IAAI;AAChD,QAAI,OAAO;AACP,YAAM,EAAE,KAAK,QAAI,wCAAsB;AAEvC,YAAM,WAAW,MAAM,aAAAA,QAAM,KAAK,UAAM,wCAAiB,UAAU,GAAG;AAAA,QAClE,SAAS,EAAE,WAAW,MAAM;AAAA,MAChC,CAAC;AACD,YAAM,MAAM,IAAI,MAAM,kBAAkB,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAEvE,UAAI,SAAS,SAAS,KAAK,UAAU,KAAK,GAAG;AACzC,cAAM,gBAAgB,WAAW,IAAI,SAAS,KAAK,gBAAgB,SAAS,KAAK;AAEjF,kBAAM,4BAAU,WAAW,KAAK,UAAU,aAAa,GAAG,UAAU,OAAO;AAC3E,cAAM,WAAW,SAAS,aAAa;AAEvC,cAAM,OAAe,YAAY,eAAe,MAAM;AACtD,cAAM,QAAe;AAAA,UACjB,GAAG;AAAA;AAAA,UACH,GAAG;AAAA;AAAA,UACH,GAAG;AAAA;AAAA,QACP;AAEA,kBAAM,4BAAU,WAAW,WAAW,YAAY,eAAe,MAAM,IAAI,CAAC,CAAC,GAAG,UAAU,OAAO;AAGjG,kBAAM,4BAAU,UAAU,YAAY,eAAe,aAAa,KAAK,KAAK,WAAW,OAAO;AAG9F,YAAI,YAAY,eAAe,OAAO,KAAK,KAAK;AAC5C,oBAAM,4BAAU,SAAS,MAAM,WAAW,OAAO;AACjD,oBAAM,4BAAU,QAAQ,YAAY,eAAe,MAAM,GAAG,UAAU,OAAO;AAAA,QACjF,OAAO;AACH,oBAAM,4BAAU,SAAS,OAAO,WAAW,OAAO;AAClD,oBAAM,4BAAU,QAAQ,MAAM,UAAU,OAAO;AAAA,QACnD;AAEA,kBAAM,4BAAU,mBAAmB,MAAM,WAAW,OAAO;AAC3D;AAAA,MACJ;AAEA,cAAQ,IAAI,MAAM,UAAU,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAC3D,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AACA;AAAA,EACJ,SAAS,OAAY;AACjB,oCAAY,6BAA6B,OAAO,OAAO;AAAA,EAC3D;AACJ;AAEA,SAAS,YAAY,QAA2C,MAA8B;AA5F9F;AA6FI,MAAI,CAAC,MAAM,QAAQ,IAAI,GAAG;AACtB,aAAO,YAAO,KAAK,UAAQ,KAAK,SAAS,IAAI,MAAtC,mBAAyC,UAAS;AAAA,EAC7D;AACA,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AAClC,UAAM,OAAM,YAAO,KAAK,UAAQ,KAAK,SAAS,KAAK,CAAC,CAAC,MAAzC,mBAA4C;AACxD,QAAI,QAAQ,KAAK;AACb,aAAO;AAAA,IACX;AAAA,EACJ;AACA,SAAO;AACX;",
  "names": ["axios"]
}
