{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceDetails.ts"],
  "sourcesContent": ["import axios from \"axios\";\r\nimport { Modes } from \"../types\";\r\nimport { getProtocolCodes } from \"./axiosParameter\";\r\nimport { getSUrlUpdateDeviceId } from \"./endPoints\";\r\nimport { saveValue } from \"./saveValue\";\r\nimport { initStore } from \"./store\";\r\n\r\nconst isAquaTemp_Poolsana = (product: string): boolean | null => {\r\n\tconst store = initStore();\r\n\tif (store.useDeviceMac) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (product == store.AQUATEMP_POOLSANA) {\r\n\t\treturn true;\r\n\t} else if (product == store.AQUATEMP_OTHER1) {\r\n\t\treturn false;\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nconst saveValues = (value: any, product: string): void => {\r\n\tconst isAquaTempPoolsana = isAquaTemp_Poolsana(product);\r\n\r\n\tif (isAquaTempPoolsana == null) {\r\n\t\treturn;\r\n\t}\r\n\t// Stromverbrauch T07 x T14 in Watt\r\n\tsaveValue(\r\n\t\t\"consumption\",\r\n\t\tparseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T07\" : \"T7\")) * parseFloat(findCodeVal(value, \"T14\")),\r\n\t\t\"number\",\r\n\t);\r\n\t// Luftansaug-Temperatur T01\r\n\tsaveValue(\"suctionTemp\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T01\" : \"T1\")), \"number\");\r\n\t// Inlet-Temperatur T02\r\n\tsaveValue(\"tempIn\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T02\" : \"T2\")), \"number\");\r\n\t// outlet-Temperatur T03\r\n\tsaveValue(\"tempOut\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T03\" : \"T3\")), \"number\");\r\n\t// Coil-Temperatur T04\r\n\tsaveValue(\"coilTemp\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T04\" : \"T4\")), \"number\");\r\n\t// Umgebungs-Temperatur T05\r\n\tsaveValue(\"ambient\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T05\" : \"T5\")), \"number\");\r\n\t// Kompressorausgang-Temperatur T06\r\n\tsaveValue(\"exhaust\", parseFloat(findCodeVal(value, isAquaTempPoolsana ? \"T06\" : \"T6\")), \"number\");\r\n\t// Str\u00F6mungsschalter S03\r\n\tsaveValue(\"flowSwitch\", numberToBoolean(findCodeVal(value, isAquaTempPoolsana ? \"S03\" : \"S3\")), \"boolean\");\r\n\t// L\u00FCfter-Drehzahl T17\r\n\tsaveValue(\"rotor\", parseInt(findCodeVal(value, \"T17\")), \"number\");\r\n};\r\nexport const numberToBoolean = (value: number): boolean => {\r\n\treturn value === 1;\r\n}\r\n\r\nexport async function updateDeviceDetails(): Promise<void> {\r\n\tconst store = initStore();\r\n\ttry {\r\n\t\tconst { apiLevel, token, device: deviceCode, product } = store;\r\n\t\tif (token) {\r\n\t\t\tconst { sURL } = getSUrlUpdateDeviceId();\r\n\r\n\t\t\tconst response = await axios.post(sURL, getProtocolCodes(deviceCode), {\r\n\t\t\t\theaders: { \"x-token\": token },\r\n\t\t\t});\r\n\t\t\tstore._this.log.info(\"DeviceDetails: \" + JSON.stringify(response.data));\r\n\r\n\t\t\tif (parseInt(response.data.error_code) == 0) {\r\n\t\t\t\tconst responseValue = apiLevel < 3 ? response.data.object_result : response.data.objectResult;\r\n\r\n\t\t\t\tsaveValue(\"rawJSON\", JSON.stringify(responseValue), \"string\");\r\n\t\t\t\tsaveValues(responseValue, product);\r\n\r\n\t\t\t\tconst mode: number = findCodeVal(responseValue, \"Mode\");\r\n\t\t\t\tconst modes: Modes = {\r\n\t\t\t\t\t1: \"R02\", // Heiz-Modus (-> R02)\r\n\t\t\t\t\t0: \"R01\", // K\u00FChl-Modus (-> R01)\r\n\t\t\t\t\t2: \"R03\", // Auto-Modus (-> R03)\r\n\t\t\t\t};\r\n\t\t\t\t// Ziel-Temperatur anhand Modus\r\n\t\t\t\tsaveValue(\"tempSet\", parseFloat(findCodeVal(responseValue, modes[mode])), \"number\");\r\n\r\n\t\t\t\t// Fl\u00FCstermodus Manual-mute\r\n\t\t\t\tsaveValue(\"silent\", findCodeVal(responseValue, \"Manual-mute\") == \"1\", \"boolean\");\r\n\r\n\t\t\t\t// Zustand Power\r\n\t\t\t\tif (findCodeVal(responseValue, \"Power\") == \"1\") {\r\n\t\t\t\t\tsaveValue(\"state\", true, \"boolean\");\r\n\t\t\t\t\tsaveValue(\"mode\", findCodeVal(responseValue, \"Mode\"), \"string\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsaveValue(\"state\", false, \"boolean\");\r\n\t\t\t\t\tsaveValue(\"mode\", \"-1\", \"string\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsaveValue(\"info.connection\", true, \"boolean\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tstore._this.log.error(\"Error: \" + JSON.stringify(response.data));\r\n\t\t\tstore.resetOnErrorHandler();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn;\r\n\t} catch (error: any) {\r\n\t\tstore._this.log.error(JSON.stringify(error));\r\n\t\tstore._this.log.error(JSON.stringify(error.stack));\r\n\t}\r\n}\r\n\r\nfunction findCodeVal(result: { value: string; code: string }[], code: string): any {\r\n\treturn result.find((item) => item.code === code)?.value || \"\";\r\n}\r\n"],
  "mappings": "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",
  "names": ["axios"]
}
