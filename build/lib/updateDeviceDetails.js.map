{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceDetails.ts"],
  "sourcesContent": ["import axios from 'axios';\r\nimport type { Modes } from '../types';\r\nimport { getProtocolCodes } from './axiosParameter';\r\nimport { getSUrlUpdateDeviceId } from './endPoints';\r\nimport { saveValue } from './saveValue';\r\nimport { initStore } from './store';\r\nimport { errorLogger } from './logging';\r\n\r\nexport const numberToBoolean = (value: number): boolean => {\r\n    return value === 1;\r\n};\r\n\r\nconst saveValues = async (value: any): Promise<void> => {\r\n    // Stromverbrauch T07 x T14 in Watt\r\n    await saveValue(\r\n        'consumption',\r\n        parseFloat(findCodeVal(value, ['T07', 'T7'])) * parseFloat(findCodeVal(value, 'T14')),\r\n        'number',\r\n    );\r\n    // Luftansaug-Temperatur T01\r\n    await saveValue('suctionTemp', parseFloat(findCodeVal(value, ['T01', 'T1'])), 'number');\r\n    // Inlet-Temperatur T02\r\n    await saveValue('tempIn', parseFloat(findCodeVal(value, ['T02', 'T2'])), 'number');\r\n    // outlet-Temperatur T03\r\n    await saveValue('tempOut', parseFloat(findCodeVal(value, ['T03', 'T3'])), 'number');\r\n    // Coil-Temperatur T04\r\n    await saveValue('coilTemp', parseFloat(findCodeVal(value, ['T04', 'T4'])), 'number');\r\n    // Umgebungs-Temperatur T05\r\n    await saveValue('ambient', parseFloat(findCodeVal(value, ['T05', 'T5'])), 'number');\r\n    // Kompressorausgang-Temperatur T06\r\n    await saveValue('exhaust', parseFloat(findCodeVal(value, ['T06', 'T6'])), 'number');\r\n    // Str\u00F6mungsschalter S03\r\n    await saveValue('flowSwitch', numberToBoolean(findCodeVal(value, ['S03', 'S3'])), 'boolean');\r\n    // L\u00FCfter-Drehzahl T17\r\n    await saveValue('rotor', parseInt(findCodeVal(value, 'T17')), 'number');\r\n};\r\n\r\nexport async function updateDeviceDetails(): Promise<void> {\r\n    const store = initStore();\r\n    try {\r\n        const { apiLevel, token, device: deviceCode } = store;\r\n        if (token) {\r\n            const { sURL } = getSUrlUpdateDeviceId();\r\n\r\n            const response = await axios.post(sURL, getProtocolCodes(deviceCode), {\r\n                headers: { 'x-token': token },\r\n            });\r\n            store._this.log.debug(`DeviceDetails: ${JSON.stringify(response.data)}`);\r\n\r\n            if (parseInt(response.data.error_code) == 0) {\r\n                const responseValue = apiLevel < 3 ? response.data.object_result : response.data.objectResult;\r\n\r\n                await saveValue('rawJSON', JSON.stringify(responseValue), 'string');\r\n                await saveValues(responseValue);\r\n\r\n                const mode: number = findCodeVal(responseValue, 'Mode');\r\n                const modes: Modes = {\r\n                    1: 'R02', // Heiz-Modus (-> R02)\r\n                    0: 'R01', // K\u00FChl-Modus (-> R01)\r\n                    2: 'R03', // Auto-Modus (-> R03)\r\n                };\r\n                // Ziel-Temperatur anhand Modus\r\n                await saveValue('tempSet', parseFloat(findCodeVal(responseValue, modes[mode])), 'number');\r\n\r\n                // Fl\u00FCstermodus Manual-mute\r\n                await saveValue('silent', findCodeVal(responseValue, 'Manual-mute') == '1', 'boolean');\r\n\r\n                // Zustand Power\r\n                if (findCodeVal(responseValue, 'Power') == '1') {\r\n                    await saveValue('state', true, 'boolean');\r\n                    await saveValue('mode', findCodeVal(responseValue, 'Mode'), 'string');\r\n                } else {\r\n                    await saveValue('state', false, 'boolean');\r\n                    await saveValue('mode', '-1', 'string');\r\n                }\r\n\r\n                await saveValue('info.connection', true, 'boolean');\r\n                return;\r\n            }\r\n\r\n            store._this.log.error(`Error: ${JSON.stringify(response.data)}`);\r\n            store.resetOnErrorHandler();\r\n            return;\r\n        }\r\n        return;\r\n    } catch (error: any) {\r\n        errorLogger('Error updateDeviceDetails', error, store._this);\r\n    }\r\n}\r\n\r\nfunction findCodeVal(result: { value: string; code: string }[], code: string | string[]): any {\r\n    if (!Array.isArray(code)) {\r\n        return result.find(item => item.code === code)?.value || '';\r\n    }\r\n    for (let i = 0; i < code.length; i++) {\r\n        const val = result.find(item => item.code === code[i])?.value;\r\n        if (val !== '0') {\r\n            return val;\r\n        }\r\n    }\r\n    return '0';\r\n}\r\n"],
  "mappings": "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",
  "names": ["axios"]
}
