{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceId.ts"],
  "sourcesContent": ["import type { MidasAquatemp } from '../main';\r\nimport { getAxiosUpdateDeviceIdParams, getHeaders } from './axiosParameter';\r\nimport { getUpdateDeviceIdSUrl } from './endPoints';\r\nimport { saveValue } from './saveValue';\r\nimport { initStore } from './store';\r\nimport { updateDeviceStatus } from './updateDeviceStatus';\r\nimport { errorLogger } from './logging';\r\nimport { request } from './axios';\r\nimport type { UpdateDeviceId } from '../types/types';\r\nimport { isToken } from './utils';\r\n\r\nexport async function updateDeviceID(adapter: MidasAquatemp): Promise<void> {\r\n    const store = initStore();\r\n    try {\r\n        const { token } = store;\r\n        if (!isToken(token)) {\r\n            return;\r\n        }\r\n\r\n        const { data, status, error } = await request<UpdateDeviceId>(\r\n            adapter,\r\n            getUpdateDeviceIdSUrl().sURL,\r\n            getAxiosUpdateDeviceIdParams(),\r\n            getHeaders(token),\r\n        );\r\n\r\n        adapter.log.debug(`UpdateDeviceID response: ${JSON.stringify(data)}, status: ${status}`);\r\n\r\n        if (!data || error) {\r\n            store.resetOnErrorHandler(); // Login-Fehler\r\n            return;\r\n        }\r\n\r\n        if (!data?.object_result?.[0]?.device_code && !data?.objectResult?.[0]?.deviceCode) {\r\n            adapter.log.error('Error in updateDeviceID: No device code found');\r\n            return;\r\n        }\r\n\r\n        store.device = data.object_result?.[0].device_code ?? data.objectResult?.[0]?.deviceCode;\r\n        store.product = data.object_result?.[0]?.product_id ?? data.objectResult?.[0]?.productId;\r\n        store.reachable = (data.object_result?.[0]?.device_status ?? data.objectResult?.[0]?.deviceStatus) == 'ONLINE';\r\n\r\n        adapter.log.debug(`device: ${store.device}, product: ${store.product}, reachable: ${store.reachable}`);\r\n\r\n        await saveValue({ key: 'DeviceCode', value: store.device, stateType: 'string', adapter: adapter });\r\n        await saveValue({ key: 'ProductCode', value: store.product, stateType: 'string', adapter: adapter });\r\n\r\n        if (store.reachable && store.device) {\r\n            await saveValue({ key: 'info.connection', value: true, stateType: 'boolean', adapter: adapter });\r\n            if (store.device != '' && store.product) {\r\n                await updateDeviceStatus(adapter);\r\n            }\r\n            return;\r\n        }\r\n        adapter.log.debug('Device not reachable');\r\n        store.resetOnErrorHandler();\r\n    } catch (error: any) {\r\n        errorLogger('Error in updateDeviceID', error, adapter);\r\n\r\n        store.token = '';\r\n        store.device = '';\r\n        store.reachable = false;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,4BAAyD;AACzD,uBAAsC;AACtC,uBAA0B;AAC1B,mBAA0B;AAC1B,gCAAmC;AACnC,qBAA4B;AAC5B,mBAAwB;AAExB,mBAAwB;AAExB,eAAsB,eAAe,SAAuC;AAX5E;AAYI,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,UAAM,EAAE,MAAM,IAAI;AAClB,QAAI,KAAC,sBAAQ,KAAK,GAAG;AACjB;AAAA,IACJ;AAEA,UAAM,EAAE,MAAM,QAAQ,MAAM,IAAI,UAAM;AAAA,MAClC;AAAA,UACA,wCAAsB,EAAE;AAAA,UACxB,oDAA6B;AAAA,UAC7B,kCAAW,KAAK;AAAA,IACpB;AAEA,YAAQ,IAAI,MAAM,4BAA4B,KAAK,UAAU,IAAI,CAAC,aAAa,MAAM,EAAE;AAEvF,QAAI,CAAC,QAAQ,OAAO;AAChB,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AAEA,QAAI,GAAC,wCAAM,kBAAN,mBAAsB,OAAtB,mBAA0B,gBAAe,GAAC,wCAAM,iBAAN,mBAAqB,OAArB,mBAAyB,aAAY;AAChF,cAAQ,IAAI,MAAM,+CAA+C;AACjE;AAAA,IACJ;AAEA,UAAM,UAAS,gBAAK,kBAAL,mBAAqB,GAAG,gBAAxB,aAAuC,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB;AAC9E,UAAM,WAAU,sBAAK,kBAAL,mBAAqB,OAArB,mBAAyB,eAAzB,aAAuC,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB;AAC/E,UAAM,cAAa,sBAAK,kBAAL,mBAAqB,OAArB,mBAAyB,kBAAzB,aAA0C,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB,iBAAiB;AAEtG,YAAQ,IAAI,MAAM,WAAW,MAAM,MAAM,cAAc,MAAM,OAAO,gBAAgB,MAAM,SAAS,EAAE;AAErG,cAAM,4BAAU,EAAE,KAAK,cAAc,OAAO,MAAM,QAAQ,WAAW,UAAU,QAAiB,CAAC;AACjG,cAAM,4BAAU,EAAE,KAAK,eAAe,OAAO,MAAM,SAAS,WAAW,UAAU,QAAiB,CAAC;AAEnG,QAAI,MAAM,aAAa,MAAM,QAAQ;AACjC,gBAAM,4BAAU,EAAE,KAAK,mBAAmB,OAAO,MAAM,WAAW,WAAW,QAAiB,CAAC;AAC/F,UAAI,MAAM,UAAU,MAAM,MAAM,SAAS;AACrC,kBAAM,8CAAmB,OAAO;AAAA,MACpC;AACA;AAAA,IACJ;AACA,YAAQ,IAAI,MAAM,sBAAsB;AACxC,UAAM,oBAAoB;AAAA,EAC9B,SAAS,OAAY;AACjB,oCAAY,2BAA2B,OAAO,OAAO;AAErD,UAAM,QAAQ;AACd,UAAM,SAAS;AACf,UAAM,YAAY;AAAA,EACtB;AACJ;",
  "names": []
}
