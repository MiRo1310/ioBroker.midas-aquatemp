{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceId.ts"],
  "sourcesContent": ["import axios from 'axios';\r\nimport type { MidasAquatemp } from '../main';\r\nimport { getAxiosUpdateDeviceIdParams } from './axiosParameter';\r\nimport { getUpdateDeviceIdSUrl } from './endPoints';\r\nimport { saveValue } from './saveValue';\r\nimport { initStore } from './store';\r\nimport { updateDeviceStatus } from './updateDeviceStatus';\r\nimport { errorLogger } from './logging';\r\n\r\nexport async function updateDeviceID(adapter: MidasAquatemp): Promise<void> {\r\n    const store = initStore();\r\n    try {\r\n        const { token, apiLevel } = store;\r\n        if (!token) {\r\n            return;\r\n        }\r\n        const { sURL } = getUpdateDeviceIdSUrl();\r\n        const options = getAxiosUpdateDeviceIdParams();\r\n        adapter.log.debug(`UpdateDeviceID URL: ${sURL}`);\r\n        adapter.log.debug(`UpdateDeviceID options: ${JSON.stringify(options)}`);\r\n\r\n        const response = await axios.post(sURL, options, {\r\n            headers: { 'x-token': token },\r\n        });\r\n\r\n        adapter.log.debug(`UpdateDeviceID response: ${JSON.stringify(response.data)}`);\r\n        adapter.log.debug(`UpdateDeviceID response status: ${JSON.stringify(response.status)}`);\r\n\r\n        if (!response || response.status !== 200 || response.data.error_code !== '0') {\r\n            // Login-Fehler\r\n            store.resetOnErrorHandler();\r\n            return;\r\n        }\r\n\r\n        if (!response.data?.object_result?.[0]?.device_code && !response.data?.objectResult?.[0]?.deviceCode) {\r\n            adapter.log.error('Error in updateDeviceID: No device code found');\r\n            adapter.log.error(`Response: ${JSON.stringify(response.data)}`);\r\n            return;\r\n        }\r\n\r\n        if (apiLevel < 3) {\r\n            store.device = response.data.object_result[0]?.device_code;\r\n            store.product = response.data.object_result[0]?.product_id;\r\n            store.reachable = response.data.object_result[0]?.device_status == 'ONLINE';\r\n        } else {\r\n            store.device = response.data.objectResult[0]?.deviceCode;\r\n            store.product = response.data.objectResult[0]?.productId;\r\n            store.reachable = response.data.objectResult[0]?.deviceStatus == 'ONLINE';\r\n        }\r\n        adapter.log.debug(`Device: ${store.device}`);\r\n        adapter.log.debug(`Product: ${store.product}`);\r\n        adapter.log.debug(`Reachable: ${store.reachable}`);\r\n\r\n        await saveValue('DeviceCode', store.device, 'string', adapter);\r\n        await saveValue('ProductCode', store.product, 'string', adapter);\r\n\r\n        if (store.reachable && store.device) {\r\n            await saveValue('info.connection', true, 'boolean', adapter);\r\n            if (store.device != '' && store.product) {\r\n                adapter.log.debug('Update device status');\r\n                await updateDeviceStatus(adapter);\r\n            }\r\n            return;\r\n        }\r\n        adapter.log.debug('Device not reachable');\r\n        store.resetOnErrorHandler();\r\n    } catch (error: any) {\r\n        errorLogger('Error in updateDeviceID', error, adapter);\r\n\r\n        store.token = '';\r\n        store.device = '';\r\n        store.reachable = false;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAElB,4BAA6C;AAC7C,uBAAsC;AACtC,uBAA0B;AAC1B,mBAA0B;AAC1B,gCAAmC;AACnC,qBAA4B;AAE5B,eAAsB,eAAe,SAAuC;AAT5E;AAUI,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,UAAM,EAAE,OAAO,SAAS,IAAI;AAC5B,QAAI,CAAC,OAAO;AACR;AAAA,IACJ;AACA,UAAM,EAAE,KAAK,QAAI,wCAAsB;AACvC,UAAM,cAAU,oDAA6B;AAC7C,YAAQ,IAAI,MAAM,uBAAuB,IAAI,EAAE;AAC/C,YAAQ,IAAI,MAAM,2BAA2B,KAAK,UAAU,OAAO,CAAC,EAAE;AAEtE,UAAM,WAAW,MAAM,aAAAA,QAAM,KAAK,MAAM,SAAS;AAAA,MAC7C,SAAS,EAAE,WAAW,MAAM;AAAA,IAChC,CAAC;AAED,YAAQ,IAAI,MAAM,4BAA4B,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAC7E,YAAQ,IAAI,MAAM,mCAAmC,KAAK,UAAU,SAAS,MAAM,CAAC,EAAE;AAEtF,QAAI,CAAC,YAAY,SAAS,WAAW,OAAO,SAAS,KAAK,eAAe,KAAK;AAE1E,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AAEA,QAAI,GAAC,0BAAS,SAAT,mBAAe,kBAAf,mBAA+B,OAA/B,mBAAmC,gBAAe,GAAC,0BAAS,SAAT,mBAAe,iBAAf,mBAA8B,OAA9B,mBAAkC,aAAY;AAClG,cAAQ,IAAI,MAAM,+CAA+C;AACjE,cAAQ,IAAI,MAAM,aAAa,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAC9D;AAAA,IACJ;AAEA,QAAI,WAAW,GAAG;AACd,YAAM,UAAS,cAAS,KAAK,cAAc,CAAC,MAA7B,mBAAgC;AAC/C,YAAM,WAAU,cAAS,KAAK,cAAc,CAAC,MAA7B,mBAAgC;AAChD,YAAM,cAAY,cAAS,KAAK,cAAc,CAAC,MAA7B,mBAAgC,kBAAiB;AAAA,IACvE,OAAO;AACH,YAAM,UAAS,cAAS,KAAK,aAAa,CAAC,MAA5B,mBAA+B;AAC9C,YAAM,WAAU,cAAS,KAAK,aAAa,CAAC,MAA5B,mBAA+B;AAC/C,YAAM,cAAY,cAAS,KAAK,aAAa,CAAC,MAA5B,mBAA+B,iBAAgB;AAAA,IACrE;AACA,YAAQ,IAAI,MAAM,WAAW,MAAM,MAAM,EAAE;AAC3C,YAAQ,IAAI,MAAM,YAAY,MAAM,OAAO,EAAE;AAC7C,YAAQ,IAAI,MAAM,cAAc,MAAM,SAAS,EAAE;AAEjD,cAAM,4BAAU,cAAc,MAAM,QAAQ,UAAU,OAAO;AAC7D,cAAM,4BAAU,eAAe,MAAM,SAAS,UAAU,OAAO;AAE/D,QAAI,MAAM,aAAa,MAAM,QAAQ;AACjC,gBAAM,4BAAU,mBAAmB,MAAM,WAAW,OAAO;AAC3D,UAAI,MAAM,UAAU,MAAM,MAAM,SAAS;AACrC,gBAAQ,IAAI,MAAM,sBAAsB;AACxC,kBAAM,8CAAmB,OAAO;AAAA,MACpC;AACA;AAAA,IACJ;AACA,YAAQ,IAAI,MAAM,sBAAsB;AACxC,UAAM,oBAAoB;AAAA,EAC9B,SAAS,OAAY;AACjB,oCAAY,2BAA2B,OAAO,OAAO;AAErD,UAAM,QAAQ;AACd,UAAM,SAAS;AACf,UAAM,YAAY;AAAA,EACtB;AACJ;",
  "names": ["axios"]
}
