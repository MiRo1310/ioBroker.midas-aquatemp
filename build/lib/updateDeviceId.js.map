{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceId.ts"],
  "sourcesContent": ["import type { MidasAquatemp } from '../main';\nimport { getAxiosUpdateDeviceIdParams, getHeaders } from './axiosParameter';\nimport { getUpdateDeviceIdSUrl } from './endPoints';\nimport { saveValue } from './saveValue';\nimport { initStore } from './store';\nimport { updateDeviceStatus } from './updateDeviceStatus';\nimport { errorLogger } from './logging';\nimport { request } from './axios';\nimport type { UpdateDeviceId } from '../types/types';\nimport { isToken } from './utils';\n\nexport async function updateDeviceID(adapter: MidasAquatemp): Promise<void> {\n    const store = initStore();\n    try {\n        const { token } = store;\n        if (!isToken(token)) {\n            return;\n        }\n\n        const { data, status, error } = await request<UpdateDeviceId>(\n            adapter,\n            getUpdateDeviceIdSUrl().sURL,\n            getAxiosUpdateDeviceIdParams(),\n            getHeaders(token),\n        );\n\n        adapter.log.debug(`UpdateDeviceID response: ${JSON.stringify(data)}, status: ${status}`);\n\n        if (!data || error) {\n            store.resetOnErrorHandler(); // Login-Fehler\n            return;\n        }\n\n        if (!data?.object_result?.[0]?.device_code && !data?.objectResult?.[0]?.deviceCode) {\n            store.resetOnErrorHandler();\n            adapter.log.error(\n                'No device code found. Maybe the token is not valid. Please check if there are not two usages of the same account. In the next loop the token will be refreshed.',\n            );\n            return;\n        }\n\n        store.device = data.object_result?.[0].device_code ?? data.objectResult?.[0]?.deviceCode;\n        store.product = data.object_result?.[0]?.product_id ?? data.objectResult?.[0]?.productId;\n        store.reachable = (data.object_result?.[0]?.device_status ?? data.objectResult?.[0]?.deviceStatus) == 'ONLINE';\n\n        adapter.log.debug(`device: ${store.device}, product: ${store.product}, reachable: ${store.reachable}`);\n\n        await saveValue({ key: 'DeviceCode', value: store.device, stateType: 'string', adapter: adapter });\n        await saveValue({ key: 'ProductCode', value: store.product, stateType: 'string', adapter: adapter });\n\n        if (store.reachable && store.device) {\n            await saveValue({ key: 'info.connection', value: true, stateType: 'boolean', adapter: adapter });\n            if (store.device != '' && store.product) {\n                await updateDeviceStatus(adapter);\n            }\n            return;\n        }\n        adapter.log.debug('Device not reachable');\n        store.resetOnErrorHandler();\n    } catch (error: any) {\n        errorLogger('Error in updateDeviceID', error, adapter);\n\n        store.token = '';\n        store.device = '';\n        store.reachable = false;\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,4BAAyD;AACzD,uBAAsC;AACtC,uBAA0B;AAC1B,mBAA0B;AAC1B,gCAAmC;AACnC,qBAA4B;AAC5B,mBAAwB;AAExB,mBAAwB;AAExB,eAAsB,eAAe,SAAuC;AAX5E;AAYI,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,UAAM,EAAE,MAAM,IAAI;AAClB,QAAI,KAAC,sBAAQ,KAAK,GAAG;AACjB;AAAA,IACJ;AAEA,UAAM,EAAE,MAAM,QAAQ,MAAM,IAAI,UAAM;AAAA,MAClC;AAAA,UACA,wCAAsB,EAAE;AAAA,UACxB,oDAA6B;AAAA,UAC7B,kCAAW,KAAK;AAAA,IACpB;AAEA,YAAQ,IAAI,MAAM,4BAA4B,KAAK,UAAU,IAAI,CAAC,aAAa,MAAM,EAAE;AAEvF,QAAI,CAAC,QAAQ,OAAO;AAChB,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AAEA,QAAI,GAAC,wCAAM,kBAAN,mBAAsB,OAAtB,mBAA0B,gBAAe,GAAC,wCAAM,iBAAN,mBAAqB,OAArB,mBAAyB,aAAY;AAChF,YAAM,oBAAoB;AAC1B,cAAQ,IAAI;AAAA,QACR;AAAA,MACJ;AACA;AAAA,IACJ;AAEA,UAAM,UAAS,gBAAK,kBAAL,mBAAqB,GAAG,gBAAxB,aAAuC,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB;AAC9E,UAAM,WAAU,sBAAK,kBAAL,mBAAqB,OAArB,mBAAyB,eAAzB,aAAuC,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB;AAC/E,UAAM,cAAa,sBAAK,kBAAL,mBAAqB,OAArB,mBAAyB,kBAAzB,aAA0C,gBAAK,iBAAL,mBAAoB,OAApB,mBAAwB,iBAAiB;AAEtG,YAAQ,IAAI,MAAM,WAAW,MAAM,MAAM,cAAc,MAAM,OAAO,gBAAgB,MAAM,SAAS,EAAE;AAErG,cAAM,4BAAU,EAAE,KAAK,cAAc,OAAO,MAAM,QAAQ,WAAW,UAAU,QAAiB,CAAC;AACjG,cAAM,4BAAU,EAAE,KAAK,eAAe,OAAO,MAAM,SAAS,WAAW,UAAU,QAAiB,CAAC;AAEnG,QAAI,MAAM,aAAa,MAAM,QAAQ;AACjC,gBAAM,4BAAU,EAAE,KAAK,mBAAmB,OAAO,MAAM,WAAW,WAAW,QAAiB,CAAC;AAC/F,UAAI,MAAM,UAAU,MAAM,MAAM,SAAS;AACrC,kBAAM,8CAAmB,OAAO;AAAA,MACpC;AACA;AAAA,IACJ;AACA,YAAQ,IAAI,MAAM,sBAAsB;AACxC,UAAM,oBAAoB;AAAA,EAC9B,SAAS,OAAY;AACjB,oCAAY,2BAA2B,OAAO,OAAO;AAErD,UAAM,QAAQ;AACd,UAAM,SAAS;AACf,UAAM,YAAY;AAAA,EACtB;AACJ;",
  "names": []
}
