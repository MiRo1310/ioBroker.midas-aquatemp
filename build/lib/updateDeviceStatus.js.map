{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceStatus.ts"],
  "sourcesContent": ["import type { MidasAquatemp } from '../main';\nimport { getUpdateDeviceStatusSUrl } from './endPoints';\nimport { saveValue } from './saveValue';\nimport { initStore } from './store';\nimport { updateDeviceDetails } from './updateDeviceDetails';\nimport { updateDeviceErrorMsg } from './updateDeviceOnError';\nimport { errorLogger } from './logging';\nimport { request } from './axios';\n\nexport async function updateDeviceStatus(adapter: MidasAquatemp): Promise<void> {\n    const store = initStore();\n    try {\n        const { token, device: deviceCode, apiLevel } = store;\n        if (token) {\n            const { sURL } = getUpdateDeviceStatusSUrl();\n\n            const response = await request(\n                adapter,\n                sURL,\n                {\n                    device_code: deviceCode,\n                    deviceCode: deviceCode,\n                },\n                {\n                    headers: { 'x-token': token },\n                },\n            );\n            if (!response?.data) {\n                return;\n            }\n            {\n                store.reachable =\n                    apiLevel < 3\n                        ? response.data.object_result?.[0]?.device_status == 'ONLINE'\n                        : response.data.objectResult?.[0]?.deviceStatus == 'ONLINE';\n            }\n\n            if (parseInt(response.data.error_code) == 0) {\n                adapter.log.debug(`DeviceStatus: ${JSON.stringify(response.data)}`);\n\n                if (response.data?.object_result?.is_fault || response?.data?.objectResult?.isFault) {\n                    adapter.log.error(`Error in updateDeviceStatus(): ${JSON.stringify(response.data)}`);\n                    // TODO: Fehlerbeschreibung abrufen\n                    //clearValues();\n                    await saveValue({ key: 'error', value: true, stateType: 'boolean', adapter: adapter });\n                    await updateDeviceDetails(adapter);\n                    await updateDeviceErrorMsg(adapter);\n                    return;\n                }\n                // kein Fehler\n                await saveValue({ key: 'error', value: false, stateType: 'boolean', adapter: adapter });\n                await saveValue({ key: 'errorMessage', value: '', stateType: 'string', adapter: adapter });\n                await saveValue({ key: 'errorCode', value: '', stateType: 'string', adapter: adapter });\n                await saveValue({ key: 'errorLevel', value: 0, stateType: 'number', adapter: adapter });\n                await updateDeviceDetails(adapter);\n\n                return;\n            }\n            store.resetOnErrorHandler();\n            return;\n        }\n        store.resetOnErrorHandler();\n    } catch (error: any) {\n        errorLogger('Error in updateDeviceStatus', error, adapter);\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,uBAA0C;AAC1C,uBAA0B;AAC1B,mBAA0B;AAC1B,iCAAoC;AACpC,iCAAqC;AACrC,qBAA4B;AAC5B,mBAAwB;AAExB,eAAsB,mBAAmB,SAAuC;AAThF;AAUI,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,UAAM,EAAE,OAAO,QAAQ,YAAY,SAAS,IAAI;AAChD,QAAI,OAAO;AACP,YAAM,EAAE,KAAK,QAAI,4CAA0B;AAE3C,YAAM,WAAW,UAAM;AAAA,QACnB;AAAA,QACA;AAAA,QACA;AAAA,UACI,aAAa;AAAA,UACb;AAAA,QACJ;AAAA,QACA;AAAA,UACI,SAAS,EAAE,WAAW,MAAM;AAAA,QAChC;AAAA,MACJ;AACA,UAAI,EAAC,qCAAU,OAAM;AACjB;AAAA,MACJ;AACA;AACI,cAAM,YACF,WAAW,MACL,oBAAS,KAAK,kBAAd,mBAA8B,OAA9B,mBAAkC,kBAAiB,aACnD,oBAAS,KAAK,iBAAd,mBAA6B,OAA7B,mBAAiC,iBAAgB;AAAA,MAC/D;AAEA,UAAI,SAAS,SAAS,KAAK,UAAU,KAAK,GAAG;AACzC,gBAAQ,IAAI,MAAM,iBAAiB,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAElE,cAAI,oBAAS,SAAT,mBAAe,kBAAf,mBAA8B,eAAY,gDAAU,SAAV,mBAAgB,iBAAhB,mBAA8B,UAAS;AACjF,kBAAQ,IAAI,MAAM,kCAAkC,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAGnF,oBAAM,4BAAU,EAAE,KAAK,SAAS,OAAO,MAAM,WAAW,WAAW,QAAiB,CAAC;AACrF,oBAAM,gDAAoB,OAAO;AACjC,oBAAM,iDAAqB,OAAO;AAClC;AAAA,QACJ;AAEA,kBAAM,4BAAU,EAAE,KAAK,SAAS,OAAO,OAAO,WAAW,WAAW,QAAiB,CAAC;AACtF,kBAAM,4BAAU,EAAE,KAAK,gBAAgB,OAAO,IAAI,WAAW,UAAU,QAAiB,CAAC;AACzF,kBAAM,4BAAU,EAAE,KAAK,aAAa,OAAO,IAAI,WAAW,UAAU,QAAiB,CAAC;AACtF,kBAAM,4BAAU,EAAE,KAAK,cAAc,OAAO,GAAG,WAAW,UAAU,QAAiB,CAAC;AACtF,kBAAM,gDAAoB,OAAO;AAEjC;AAAA,MACJ;AACA,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AACA,UAAM,oBAAoB;AAAA,EAC9B,SAAS,OAAY;AACjB,oCAAY,+BAA+B,OAAO,OAAO;AAAA,EAC7D;AACJ;",
  "names": []
}
