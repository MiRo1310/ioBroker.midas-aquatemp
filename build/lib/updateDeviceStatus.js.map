{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceStatus.ts"],
  "sourcesContent": ["import axios from 'axios';\r\nimport { MidasAquatemp } from '../main';\r\nimport { getUpdateDeviceStatusSUrl } from './endPoints';\r\nimport { saveValue } from './saveValue';\r\nimport { initStore } from './store';\r\nimport { updateDeviceDetails } from './updateDeviceDetails';\r\nimport { updateDeviceErrorMsg } from './updateDeviceOnError';\r\nimport { errorLogger } from './logging';\r\n\r\nlet _this: MidasAquatemp;\r\n\r\nexport async function updateDeviceStatus(adapter: MidasAquatemp): Promise<void> {\r\n    const store = initStore();\r\n    try {\r\n        if (!_this) {\r\n            _this = MidasAquatemp.getInstance();\r\n        }\r\n        const { token, device: deviceCode, apiLevel } = store;\r\n        if (token) {\r\n            const { sURL } = getUpdateDeviceStatusSUrl();\r\n\r\n            const response = await axios.post(\r\n                sURL,\r\n                {\r\n                    device_code: deviceCode,\r\n                    deviceCode: deviceCode,\r\n                },\r\n                {\r\n                    headers: { 'x-token': token },\r\n                },\r\n            );\r\n\r\n            store.reachable =\r\n                apiLevel < 3\r\n                    ? response.data.object_result?.[0]?.device_status == 'ONLINE'\r\n                    : response.data.objectResult?.[0]?.deviceStatus == 'ONLINE';\r\n\r\n            adapter.log.debug(`DeviceStatus: ${JSON.stringify(response.data)}`);\r\n\r\n            if (parseInt(response.data.error_code) == 0) {\r\n                if (response.data?.object_result?.is_fault || response.data?.objectResult?.isFault) {\r\n                    store._this.log.error(`Error in updateDeviceStatus(): ${JSON.stringify(response.data)}`);\r\n                    // TODO: Fehlerbeschreibung abrufen\r\n                    //clearValues();\r\n                    await saveValue('error', true, 'boolean', adapter);\r\n                    await updateDeviceDetails(adapter);\r\n                    await updateDeviceErrorMsg(adapter);\r\n                    return;\r\n                }\r\n                // kein Fehler\r\n                await saveValue('error', false, 'boolean', adapter);\r\n                await saveValue('errorMessage', '', 'string', adapter);\r\n                await saveValue('errorCode', '', 'string', adapter);\r\n                await saveValue('errorLevel', 0, 'number', adapter);\r\n                await updateDeviceDetails(adapter);\r\n\r\n                return;\r\n            }\r\n            store.resetOnErrorHandler();\r\n            return;\r\n        }\r\n        store.resetOnErrorHandler();\r\n    } catch (error: any) {\r\n        errorLogger('Error in updateDeviceStatus', error, store._this);\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,kBAA8B;AAC9B,uBAA0C;AAC1C,uBAA0B;AAC1B,mBAA0B;AAC1B,iCAAoC;AACpC,iCAAqC;AACrC,qBAA4B;AAE5B,IAAI;AAEJ,eAAsB,mBAAmB,SAAuC;AAXhF;AAYI,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACA,QAAI,CAAC,OAAO;AACR,cAAQ,0BAAc,YAAY;AAAA,IACtC;AACA,UAAM,EAAE,OAAO,QAAQ,YAAY,SAAS,IAAI;AAChD,QAAI,OAAO;AACP,YAAM,EAAE,KAAK,QAAI,4CAA0B;AAE3C,YAAM,WAAW,MAAM,aAAAA,QAAM;AAAA,QACzB;AAAA,QACA;AAAA,UACI,aAAa;AAAA,UACb;AAAA,QACJ;AAAA,QACA;AAAA,UACI,SAAS,EAAE,WAAW,MAAM;AAAA,QAChC;AAAA,MACJ;AAEA,YAAM,YACF,WAAW,MACL,oBAAS,KAAK,kBAAd,mBAA8B,OAA9B,mBAAkC,kBAAiB,aACnD,oBAAS,KAAK,iBAAd,mBAA6B,OAA7B,mBAAiC,iBAAgB;AAE3D,cAAQ,IAAI,MAAM,iBAAiB,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAElE,UAAI,SAAS,SAAS,KAAK,UAAU,KAAK,GAAG;AACzC,cAAI,oBAAS,SAAT,mBAAe,kBAAf,mBAA8B,eAAY,oBAAS,SAAT,mBAAe,iBAAf,mBAA6B,UAAS;AAChF,gBAAM,MAAM,IAAI,MAAM,kCAAkC,KAAK,UAAU,SAAS,IAAI,CAAC,EAAE;AAGvF,oBAAM,4BAAU,SAAS,MAAM,WAAW,OAAO;AACjD,oBAAM,gDAAoB,OAAO;AACjC,oBAAM,iDAAqB,OAAO;AAClC;AAAA,QACJ;AAEA,kBAAM,4BAAU,SAAS,OAAO,WAAW,OAAO;AAClD,kBAAM,4BAAU,gBAAgB,IAAI,UAAU,OAAO;AACrD,kBAAM,4BAAU,aAAa,IAAI,UAAU,OAAO;AAClD,kBAAM,4BAAU,cAAc,GAAG,UAAU,OAAO;AAClD,kBAAM,gDAAoB,OAAO;AAEjC;AAAA,MACJ;AACA,YAAM,oBAAoB;AAC1B;AAAA,IACJ;AACA,UAAM,oBAAoB;AAAA,EAC9B,SAAS,OAAY;AACjB,oCAAY,+BAA+B,OAAO,MAAM,KAAK;AAAA,EACjE;AACJ;",
  "names": ["axios"]
}
