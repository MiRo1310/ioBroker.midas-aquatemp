{
  "version": 3,
  "sources": ["../../src/lib/updateDeviceStatus.ts"],
  "sourcesContent": ["import axios from \"axios\";\nimport { MidasAquatemp } from \"../main\";\nimport { getUpdateDeviceStatusSUrl } from \"./endPoints\";\nimport { saveValue } from \"./saveValue\";\nimport { initStore } from \"./store\";\nimport { updateDeviceDetails } from \"./updateDeviceDetails\";\nimport { updateDeviceErrorMsg } from \"./updateDeviceOnError\";\n\nlet _this: MidasAquatemp;\n\nexport async function updateDeviceStatus(): Promise<void> {\n\tconst store = initStore();\n\ttry {\n\t\tif (!_this) {\n\t\t\t_this = MidasAquatemp.getInstance();\n\t\t}\n\t\tconst { token, device: deviceCode, apiLevel } = store;\n\t\tif (token) {\n\t\t\tconst { sURL } = getUpdateDeviceStatusSUrl();\n\n\t\t\tconst response = await axios.post(\n\t\t\t\tsURL,\n\t\t\t\t{\n\t\t\t\t\tdevice_code: deviceCode,\n\t\t\t\t\tdeviceCode: deviceCode,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\theaders: { \"x-token\": token },\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tstore.reachable =\n\t\t\t\tapiLevel < 3\n\t\t\t\t\t? response.data.object_result[0]?.device_status == \"ONLINE\"\n\t\t\t\t\t: response.data.objectResult[0]?.deviceStatus == \"ONLINE\";\n\n\t\t\tif (parseInt(response.data.error_code) == 0) {\n\t\t\t\tif (response.data?.object_result?.[\"is_fault\"] || response.data?.objectResult?.[\"isFault\"]) {\n\t\t\t\t\tstore._this.log.error(\"Error in updateDeviceStatus(): \" + JSON.stringify(response.data));\n\t\t\t\t\t// TODO: Fehlerbeschreibung abrufen\n\t\t\t\t\t//clearValues();\n\t\t\t\t\tawait saveValue(\"error\", true, \"boolean\");\n\t\t\t\t\tawait updateDeviceDetails();\n\t\t\t\t\tawait updateDeviceErrorMsg();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// kein Fehler\n\t\t\t\tawait saveValue(\"error\", false, \"boolean\");\n\t\t\t\tawait saveValue(\"errorMessage\", \"\", \"string\");\n\t\t\t\tawait saveValue(\"errorCode\", \"\", \"string\");\n\t\t\t\tawait saveValue(\"errorLevel\", 0, \"number\");\n\t\t\t\tawait updateDeviceDetails();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tstore.resetOnErrorHandler();\n\t\t\treturn;\n\t\t}\n\t\tstore.resetOnErrorHandler();\n\t} catch (error: any) {\n\t\tstore._this.log.error(JSON.stringify(error));\n\t\tstore._this.log.error(JSON.stringify(error.stack));\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,kBAA8B;AAC9B,uBAA0C;AAC1C,uBAA0B;AAC1B,mBAA0B;AAC1B,iCAAoC;AACpC,iCAAqC;AAErC,IAAI;AAEJ,eAAsB,qBAAoC;AAV1D;AAWC,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACH,QAAI,CAAC,OAAO;AACX,cAAQ,0BAAc,YAAY;AAAA,IACnC;AACA,UAAM,EAAE,OAAO,QAAQ,YAAY,SAAS,IAAI;AAChD,QAAI,OAAO;AACV,YAAM,EAAE,KAAK,QAAI,4CAA0B;AAE3C,YAAM,WAAW,MAAM,aAAAA,QAAM;AAAA,QAC5B;AAAA,QACA;AAAA,UACC,aAAa;AAAA,UACb;AAAA,QACD;AAAA,QACA;AAAA,UACC,SAAS,EAAE,WAAW,MAAM;AAAA,QAC7B;AAAA,MACD;AAEA,YAAM,YACL,WAAW,MACR,cAAS,KAAK,cAAc,CAAC,MAA7B,mBAAgC,kBAAiB,aACjD,cAAS,KAAK,aAAa,CAAC,MAA5B,mBAA+B,iBAAgB;AAEnD,UAAI,SAAS,SAAS,KAAK,UAAU,KAAK,GAAG;AAC5C,cAAI,oBAAS,SAAT,mBAAe,kBAAf,mBAA+B,kBAAe,oBAAS,SAAT,mBAAe,iBAAf,mBAA8B,aAAY;AAC3F,gBAAM,MAAM,IAAI,MAAM,oCAAoC,KAAK,UAAU,SAAS,IAAI,CAAC;AAGvF,oBAAM,4BAAU,SAAS,MAAM,SAAS;AACxC,oBAAM,gDAAoB;AAC1B,oBAAM,iDAAqB;AAC3B;AAAA,QACD;AAEA,kBAAM,4BAAU,SAAS,OAAO,SAAS;AACzC,kBAAM,4BAAU,gBAAgB,IAAI,QAAQ;AAC5C,kBAAM,4BAAU,aAAa,IAAI,QAAQ;AACzC,kBAAM,4BAAU,cAAc,GAAG,QAAQ;AACzC,kBAAM,gDAAoB;AAE1B;AAAA,MACD;AACA,YAAM,oBAAoB;AAC1B;AAAA,IACD;AACA,UAAM,oBAAoB;AAAA,EAC3B,SAAS,OAAY;AACpB,UAAM,MAAM,IAAI,MAAM,KAAK,UAAU,KAAK,CAAC;AAC3C,UAAM,MAAM,IAAI,MAAM,KAAK,UAAU,MAAM,KAAK,CAAC;AAAA,EAClD;AACD;",
  "names": ["axios"]
}
