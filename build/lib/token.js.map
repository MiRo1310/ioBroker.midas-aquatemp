{
  "version": 3,
  "sources": ["../../src/lib/token.ts"],
  "sourcesContent": ["import axios from \"axios\";\nimport { getOptionsAnsSUrl } from \"./endPoints\";\nimport { saveValue } from \"./saveValue\";\nimport { initStore } from \"./store\";\nimport { updateDeviceID } from \"./updateDeviceId\";\n\n\n\nasync function getToken(): Promise<void> {\n\tconst store = initStore();\n\tconst _this = store._this;\n\ttry {\n\t\tconst { token, apiLevel } = store;\n\n\t\tif (!token) {\n\t\t\t_this.log.info(\"Request token\");\n\n\t\t\tconst { sUrl, options } = getOptionsAnsSUrl();\n\n\t\t\tconst response = await axios.post(sUrl, options);\n\n\t\t\tif (response.status == 200) {\n\t\t\t\tif (apiLevel < 3) {\n\t\t\t\t\tstore.token = response.data?.object_result?.[\"x-token\"];\n\t\t\t\t} else {\n\t\t\t\t\tstore.token = response.data?.objectResult?.[\"x-token\"];\n\t\t\t\t}\n\t\t\t\t_this.log.info(\"Login ok! Token: \" + token);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_this.log.error(\"Login-error: \" + response.data);\n\t\t\tstore.token = null;\n\t\t\treturn;\n\t\t}\n\t\treturn;\n\t} catch (error) {\n\t\t_this.log.error(\"Error in getToken(): \" + JSON.stringify(error));\n\t}\n}\n\nexport const updateToken = async (): Promise<void> => {\n\tconst store = initStore();\n\ttry {\n\t\tawait getToken();\n\n\t\tif (store.token) {\n\t\t\tawait updateDeviceID();\n\t\t\treturn;\n\t\t}\n\n\t\tstore.resetOnErrorHandler();\n\t\tsaveValue(\"info.connection\", false, \"boolean\");\n\t\treturn;\n\t} catch (error: any) {\n\t\tstore._this.log.error(\"Error in updateToken(): \" + JSON.stringify(error));\n\t\tstore._this.log.error(\"Error in updateToken(): \" + JSON.stringify(error.stack));\n\t}\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,uBAAkC;AAClC,uBAA0B;AAC1B,mBAA0B;AAC1B,4BAA+B;AAI/B,eAAe,WAA0B;AARzC;AASC,QAAM,YAAQ,wBAAU;AACxB,QAAM,QAAQ,MAAM;AACpB,MAAI;AACH,UAAM,EAAE,OAAO,SAAS,IAAI;AAE5B,QAAI,CAAC,OAAO;AACX,YAAM,IAAI,KAAK,eAAe;AAE9B,YAAM,EAAE,MAAM,QAAQ,QAAI,oCAAkB;AAE5C,YAAM,WAAW,MAAM,aAAAA,QAAM,KAAK,MAAM,OAAO;AAE/C,UAAI,SAAS,UAAU,KAAK;AAC3B,YAAI,WAAW,GAAG;AACjB,gBAAM,SAAQ,oBAAS,SAAT,mBAAe,kBAAf,mBAA+B;AAAA,QAC9C,OAAO;AACN,gBAAM,SAAQ,oBAAS,SAAT,mBAAe,iBAAf,mBAA8B;AAAA,QAC7C;AACA,cAAM,IAAI,KAAK,sBAAsB,KAAK;AAC1C;AAAA,MACD;AAEA,YAAM,IAAI,MAAM,kBAAkB,SAAS,IAAI;AAC/C,YAAM,QAAQ;AACd;AAAA,IACD;AACA;AAAA,EACD,SAAS,OAAO;AACf,UAAM,IAAI,MAAM,0BAA0B,KAAK,UAAU,KAAK,CAAC;AAAA,EAChE;AACD;AAEO,MAAM,cAAc,YAA2B;AACrD,QAAM,YAAQ,wBAAU;AACxB,MAAI;AACH,UAAM,SAAS;AAEf,QAAI,MAAM,OAAO;AAChB,gBAAM,sCAAe;AACrB;AAAA,IACD;AAEA,UAAM,oBAAoB;AAC1B,oCAAU,mBAAmB,OAAO,SAAS;AAC7C;AAAA,EACD,SAAS,OAAY;AACpB,UAAM,MAAM,IAAI,MAAM,6BAA6B,KAAK,UAAU,KAAK,CAAC;AACxE,UAAM,MAAM,IAAI,MAAM,6BAA6B,KAAK,UAAU,MAAM,KAAK,CAAC;AAAA,EAC/E;AACD;",
  "names": ["axios"]
}
