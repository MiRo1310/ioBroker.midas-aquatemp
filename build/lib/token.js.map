{
  "version": 3,
  "sources": ["../../src/lib/token.ts"],
  "sourcesContent": ["import axios from \"axios\";\r\nimport { getOptionsAndSUrl } from \"./endPoints\";\r\nimport { initStore as useStore } from \"./store\";\r\nimport { updateDeviceID } from \"./updateDeviceId\";\r\nimport { updateDeviceStatus } from \"./updateDeviceStatus\";\r\n\r\nasync function getToken(): Promise<void> {\r\n\tconst store = useStore();\r\n\tconst _this = store._this;\r\n\ttry {\r\n\t\tconst { token, apiLevel } = store;\r\n\r\n\t\tif (!token) {\r\n\t\t\t_this.log.info(\"Request token\");\r\n\t\t\tconst { sUrl, options } = getOptionsAndSUrl();\r\n\r\n\t\t\tconst response = await axios.post(sUrl, options);\r\n\t\t\tif (!response) {\r\n\t\t\t\t_this.log.error(\"No response from server\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (response.status == 200) {\r\n\t\t\t\tstore.token =\r\n\t\t\t\t\tapiLevel < 3\r\n\t\t\t\t\t\t? response.data?.object_result?.[\"x-token\"]\r\n\t\t\t\t\t\t: (store.token = response.data?.objectResult?.[\"x-token\"]);\r\n\t\t\t\tif (store.token) { _this.log.info(\"Login ok! Token: \" + store.token) }\r\n\t\t\t\telse { _this.log.error(\"Login-error: \" + JSON.stringify(response.data)) };\r\n\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t_this.log.error(\"Login-error: \" + response.data);\r\n\t\t\tstore.resetOnErrorHandler();\r\n\t\t\treturn;\r\n\t\t}\r\n\t} catch (error) {\r\n\t\t_this.log.error(\"Error in getToken(): \" + JSON.stringify(error));\r\n\t}\r\n}\r\n\r\nexport const updateToken = async (): Promise<void> => {\r\n\tconst store = useStore();\r\n\ttry {\r\n\t\tawait getToken();\r\n\r\n\t\tif (!store.token) {\r\n\t\t\tstore.resetOnErrorHandler();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (store.useDeviceMac) {\r\n\t\t\tawait updateDeviceStatus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tawait updateDeviceID();\r\n\t\treturn;\r\n\t} catch (error: any) {\r\n\t\tstore._this.log.error(\"Error in updateToken(): \" + JSON.stringify(error));\r\n\t\tstore._this.log.error(\"Error in updateToken(): \" + JSON.stringify(error.stack));\r\n\t}\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAkB;AAClB,uBAAkC;AAClC,mBAAsC;AACtC,4BAA+B;AAC/B,gCAAmC;AAEnC,eAAe,WAA0B;AANzC;AAOC,QAAM,YAAQ,aAAAA,WAAS;AACvB,QAAM,QAAQ,MAAM;AACpB,MAAI;AACH,UAAM,EAAE,OAAO,SAAS,IAAI;AAE5B,QAAI,CAAC,OAAO;AACX,YAAM,IAAI,KAAK,eAAe;AAC9B,YAAM,EAAE,MAAM,QAAQ,QAAI,oCAAkB;AAE5C,YAAM,WAAW,MAAM,aAAAC,QAAM,KAAK,MAAM,OAAO;AAC/C,UAAI,CAAC,UAAU;AACd,cAAM,IAAI,MAAM,yBAAyB;AACzC;AAAA,MACD;AACA,UAAI,SAAS,UAAU,KAAK;AAC3B,cAAM,QACL,WAAW,KACR,oBAAS,SAAT,mBAAe,kBAAf,mBAA+B,aAC9B,MAAM,SAAQ,oBAAS,SAAT,mBAAe,iBAAf,mBAA8B;AACjD,YAAI,MAAM,OAAO;AAAE,gBAAM,IAAI,KAAK,sBAAsB,MAAM,KAAK;AAAA,QAAE,OAChE;AAAE,gBAAM,IAAI,MAAM,kBAAkB,KAAK,UAAU,SAAS,IAAI,CAAC;AAAA,QAAE;AAAC;AAGzE;AAAA,MACD;AAEA,YAAM,IAAI,MAAM,kBAAkB,SAAS,IAAI;AAC/C,YAAM,oBAAoB;AAC1B;AAAA,IACD;AAAA,EACD,SAAS,OAAO;AACf,UAAM,IAAI,MAAM,0BAA0B,KAAK,UAAU,KAAK,CAAC;AAAA,EAChE;AACD;AAEO,MAAM,cAAc,YAA2B;AACrD,QAAM,YAAQ,aAAAD,WAAS;AACvB,MAAI;AACH,UAAM,SAAS;AAEf,QAAI,CAAC,MAAM,OAAO;AACjB,YAAM,oBAAoB;AAC1B;AAAA,IACD;AACA,QAAI,MAAM,cAAc;AACvB,gBAAM,8CAAmB;AACzB;AAAA,IACD;AACA,cAAM,sCAAe;AACrB;AAAA,EACD,SAAS,OAAY;AACpB,UAAM,MAAM,IAAI,MAAM,6BAA6B,KAAK,UAAU,KAAK,CAAC;AACxE,UAAM,MAAM,IAAI,MAAM,6BAA6B,KAAK,UAAU,MAAM,KAAK,CAAC;AAAA,EAC/E;AACD;",
  "names": ["useStore", "axios"]
}
